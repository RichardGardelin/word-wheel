<?xml version="1.0" encoding="UTF-8"?>
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:WordWheel.ViewModels.StudyView"
             xmlns:models="clr-namespace:WordWheel.Models"
             xmlns:components="clr-namespace:WordWheel.Views.Components"
             x:Class="WordWheel.Views.Pages.StudyView"
             x:Name="Root"
             x:DataType="vm:StudyViewModel"
             d:DesignWidth="1280"
             d:DesignHeight="832"
             Background="#453A31">
    <DockPanel LastChildFill="True">
        <!-- ==================== HEADER ==================== -->
        <Border DockPanel.Dock="Top"
                Background="#7A6945"
                Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Button Name="ProfileButton"
                        Content="Profiles &amp; Settings"
                        Width="140"
                        Height="32"
                        BorderBrush="Black"
                        BorderThickness="1"
                        Background="#CCC1AA"
                        HorizontalContentAlignment="Center"
                        HorizontalAlignment="Left"
                        VerticalContentAlignment="Center"
                        VerticalAlignment="Center"
                        Opacity="0"
                        IsHitTestVisible="False" />
                <TextBlock Text="Word Wheel"
                           Grid.Column="1"
                           FontSize="26"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center" />
                <!-- Placeholder for spacing -->
                <Rectangle Grid.Column="2"
                           Width="{Binding Width, ElementName=ProfileButton}"
                           Height="0"
                           Opacity="0"
                           IsHitTestVisible="False" />
            </Grid>
        </Border>
        <!-- ==================== FILTER BOX ==================== -->
        <Border DockPanel.Dock="Bottom"
                Background="#7A6945"
                Padding="20"
                CornerRadius="10"
                Margin="10,10"
                Height="230"
                HorizontalAlignment="Stretch">
            <Grid>
                <!-- ====== Base Grid Layout ====== -->
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <!-- ========= LEFT COLUMN ========= -->
                <StackPanel Grid.Column="0"
                            Orientation="Vertical"
                            VerticalAlignment="Top"
                            Spacing="10">
                    <!-- ==== BOOK SELECTOR BUTTON ==== -->
                    <ToggleButton x:Name="BookToggle"
                                  Content="{Binding DataContext.BookSelector.BookSelectionLabel, ElementName=Root}"
                                  Width="250"
                                  Height="32"
                                  Background="#CCC1AA"
                                  BorderBrush="Black"
                                  BorderThickness="1"
                                  Padding="10,5"
                                  FontWeight="Bold"
                                  HorizontalAlignment="Left"
                                  HorizontalContentAlignment="Center"
                                  IsChecked="{Binding IsBookSelectorOpen}" />
                    <!-- ==== POS SELECTOR BUTTON ==== -->
                    <ToggleButton x:Name="PosToggle"
                                  Content="{Binding DataContext.PosSelector.PosSelectionLabel, ElementName=Root}"
                                  Width="250"
                                  Height="32"
                                  Background="#CCC1AA"
                                  BorderBrush="Black"
                                  BorderThickness="1"
                                  Padding="10,5"
                                  FontWeight="Bold"
                                  HorizontalAlignment="Left"
                                  HorizontalContentAlignment="Center"
                                  IsChecked="{Binding IsPosSelectorOpen}" />
                    <!-- ==== RANDOM WORD SELECTOR ==== -->
                    <components:RandomWordSelectorView HorizontalAlignment="Left"
                                                       VerticalAlignment="Top"
                                                       DataContext="{Binding RandomWordSelector}" />
                </StackPanel>
                <!-- ========= MIDDLE COLUMN ========= -->
                <StackPanel Grid.Column="1"
                            Orientation="Vertical"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Top"
                            Spacing="6">
                    <Button Name="RandomizeButton"
                            Content="Draw Words"
                            Command="{Binding RandomizeCommand}"
                            Width="180"
                            Height="44"
                            BorderBrush="Black"
                            BorderThickness="1"
                            Background="#ccc1aa"
                            FontWeight="Bold"
                            HorizontalAlignment="Center"
                            FontSize="20"
                            VerticalContentAlignment="Center"
                            HorizontalContentAlignment="Center" />
                    <!-- ==== DRAW SUMMARY TEXT ==== -->
                    <Border Background="#CCC1AA"
                            BorderBrush="Black"
                            BorderThickness="1"
                            CornerRadius="4"
                            Padding="6"
                            Width="250"
                            Height="140"
                            HorizontalAlignment="Center">
                        <TextBlock Text="{Binding AvailableWordsCount, StringFormat='Available words: {0}'}"
                                   TextAlignment="Center"
                                   HorizontalAlignment="Center"
                                   TextWrapping="Wrap"
                                   FontWeight="Bold"
                                   FontSize="12" />
                    </Border>
                </StackPanel>
                <!-- ========= RIGHT COLUMN ========= -->
                <StackPanel Grid.Column="2"
                            Orientation="Vertical"
                            VerticalAlignment="Top"
                            HorizontalAlignment="Right"
                            Spacing="8">
                    <Border Background="#CCC1AA"
                            BorderBrush="Black"
                            BorderThickness="1"
                            CornerRadius="4"
                            Height="32"
                            Padding="10,5">
                        <CheckBox Content="Hide English"
                                  FontWeight="Bold"
                                  IsChecked="{Binding HideEnglish}" />
                    </Border>
                    <Border Background="#CCC1AA"
                            BorderBrush="Black"
                            BorderThickness="1"
                            CornerRadius="4"
                            Height="32"
                            Padding="10,5">
                        <CheckBox Content="Hide Pinyin"
                                  FontWeight="Bold"
                                  IsChecked="{Binding HidePinyin}" />
                    </Border>
                    <Border Background="#CCC1AA"
                            BorderBrush="Black"
                            BorderThickness="1"
                            CornerRadius="4"
                            Height="32"
                            Padding="10,5">
                        <CheckBox Content="Hide POS"
                                  FontWeight="Bold"
                                  IsChecked="{Binding HidePos}" />
                    </Border>
                    <Border Background="#CCC1AA"
                            BorderBrush="Black"
                            BorderThickness="1"
                            CornerRadius="4"
                            Height="32"
                            Padding="10,5">
                        <CheckBox Content="Allow Repeats"
                                  FontWeight="Bold"
                                  IsChecked="{Binding WordRepeats}" />
                    </Border>
                </StackPanel>
                <!-- ========= BOOK SELECTOR OVERLAY ========= -->
                <components:BookSelectorView IsVisible="{Binding DataContext.IsBookSelectorOpen, ElementName=Root}"
                                             DataContext="{Binding BookSelector}"
                                             HorizontalAlignment="Left"
                                             VerticalAlignment="Top" />
                <!-- ========= POS SELECTOR OVERLAY ========= -->
                <components:PosSelectorView IsVisible="{Binding DataContext.IsPosSelectorOpen, ElementName=Root}"
                                            DataContext="{Binding PosSelector}"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Top" />
            </Grid>
        </Border>
        <!-- ==================== MAIN CONTENT ==================== -->
        <ScrollViewer Margin="0,20,0,0">
            <StackPanel HorizontalAlignment="Center"
                        MaxWidth="1050"
                        Spacing="20">
                <!-- ========== CARD WINDOW ========== -->
                <Border Background="#CCC1AA"
                        CornerRadius="12"
                        Padding="10"
                        HorizontalAlignment="Stretch"
                        Width="1010"
                        MinHeight="380">
                    <!-- Use ItemsControl bound to CurrentWords -->
                    <ItemsControl ItemsSource="{Binding CurrentWords}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"
                                           HorizontalAlignment="Center" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <!-- Single Card -->
                                <Border Background="#7A6945"
                                        Width="310"
                                        Height="360"
                                        Margin="10"
                                        CornerRadius="8"
                                        Padding="10"
                                        BorderBrush="#555"
                                        BorderThickness="1">
                                    <Grid RowDefinitions="*,Auto">
                                        <!-- Card Content -->
                                        <Grid>
                                            <StackPanel VerticalAlignment="Center"
                                                        HorizontalAlignment="Center"
                                                        Spacing="10">
                                                <TextBlock Text="{Binding Word.Character}"
                                                           FontSize="72"
                                                           FontFamily="avares://WordWheel/Assets/Fonts/KaiTi.ttf#KaiTi"
                                                           HorizontalAlignment="Center" />
                                                <TextBlock Text="{Binding Word.Pinyin}"
                                                           FontSize="30"
                                                           HorizontalAlignment="Center"
                                                           IsVisible="{Binding DataContext.HidePinyin, ElementName=Root, Converter={StaticResource InverseBoolConverter}}" />
                                                <TextBlock Text="{Binding Word.English}"
                                                           FontSize="18"
                                                           HorizontalAlignment="Center"
                                                           TextWrapping="Wrap"
                                                           TextAlignment="Center"
                                                           IsVisible="{Binding DataContext.HideEnglish, ElementName=Root, Converter={StaticResource InverseBoolConverter}}" />
                                            </StackPanel>
                                        </Grid>
                                        <!-- POS text at bottom -->
                                        <TextBlock Grid.Row="1"
                                                   Text="{Binding PickedForPOS}"
                                                   FontSize="14"
                                                   FontWeight="Bold"
                                                   HorizontalAlignment="Center"
                                                   Margin="0,10,0,0"
                                                   IsVisible="{Binding DataContext.HidePos, ElementName=Root, Converter={StaticResource InverseBoolConverter}}" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</UserControl>