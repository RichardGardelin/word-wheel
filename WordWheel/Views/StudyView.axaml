<?xml version="1.0" encoding="UTF-8"?>
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:WordWheel.ViewModels"
             xmlns:models="clr-namespace:WordWheel.Models"
             x:Class="WordWheel.Views.StudyView"
             x:Name="Root"
             x:DataType="vm:StudyViewModel"
             d:DesignWidth="1280"
             d:DesignHeight="832"
             Background="#453A31">
    <DockPanel LastChildFill="True">
        <!-- ==================== HEADER ==================== -->
        <Border DockPanel.Dock="Top"
                Background="#7A6945"
                Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Button Name="ProfileButton"
                        Content="Profiles &amp; Settings"
                        Width="180"
                        Height="32"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center" />
                <TextBlock Text="Word Wheel"
                           Grid.Column="1"
                           FontSize="24"
                           Foreground="Black"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center" />
                <!-- Placeholder for spacing -->
                <Rectangle Grid.Column="2"
                           Width="{Binding Width, ElementName=ProfileButton}"
                           Height="0"
                           Opacity="0"
                           IsHitTestVisible="False" />
            </Grid>
        </Border>
        <!-- ==================== FILTER BOX ==================== -->
        <Border DockPanel.Dock="Bottom"
                Background="#7A6945"
                Padding="20"
                CornerRadius="10"
                Margin="20,10"
                Height="230"
                HorizontalAlignment="Stretch">
            <Grid ColumnDefinitions="*,Auto,*"
                  HorizontalAlignment="Stretch"
                  ColumnSpacing="40">
                <!-- ========== LEFT COLUMN ========== -->
                <StackPanel Grid.Column="0"
                            Orientation="Vertical"
                            VerticalAlignment="Top"
                            Spacing="20">
                    <!-- Book Selector -->
                    <StackPanel Orientation="Horizontal"
                                Spacing="10">
                        <TextBlock Text="Select Book:"
                                   VerticalAlignment="Center"
                                   Foreground="Black"
                                   FontWeight="Bold" />
                        <ComboBox Width="150"
                                  Background="#CCC1AA"
                                  ItemsSource="{Binding AvailableBooks}"
                                  SelectedItem="{Binding SelectedBook, Mode=TwoWay}" />
                    </StackPanel>
                    <!-- POS Selector -->
                    <StackPanel>
                        <ToggleButton x:Name="PosToggle"
                                      Content="{Binding PosSelectionLabel}"
                                      Width="250"
                                      Height="32"
                                      Background="#CCC1AA"
                                      BorderBrush="Black"
                                      BorderThickness="1"
                                      Padding="10,5"
                                      FontWeight="Bold"
                                      Foreground="Black"
                                      HorizontalAlignment="Left"
                                      HorizontalContentAlignment="Center"
                                      Margin="0,0,0,5" />
                        <Border Background="#CCC1AA"
                                CornerRadius="6"
                                Padding="5"
                                BorderBrush="Black"
                                BorderThickness="1"
                                Margin="0,5,0,0"
                                IsVisible="{Binding IsChecked, ElementName=PosToggle}">
                            <ScrollViewer MaxHeight="100">
                                <ItemsControl ItemsSource="{Binding PosOptions}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal"
                                                        Margin="4,2"
                                                        VerticalAlignment="Center"
                                                        Spacing="8">
                                                <!-- Checkbox -->
                                                <CheckBox IsChecked="{Binding IsSelected}"
                                                          VerticalAlignment="Center" />
                                                <!-- POS Name -->
                                                <TextBlock Text="{Binding Name}"
                                                           Foreground="Black"
                                                           VerticalAlignment="Center"
                                                           Margin="5,0,0,0"
                                                           Width="120" />
                                                <!-- Number Box -->
                                                <Border Width="50"
                                                        Height="28"
                                                        Background="White"
                                                        BorderBrush="Black"
                                                        BorderThickness="1"
                                                        CornerRadius="4"
                                                        VerticalAlignment="Center"
                                                        IsVisible="{Binding IsSelected}">
                                                    <TextBlock Text="{Binding Count}"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"
                                                               FontWeight="Bold" />
                                                </Border>
                                                <!-- Arrow Buttons -->
                                                <StackPanel Orientation="Horizontal"
                                                            Margin="5,0,0,0"
                                                            VerticalAlignment="Center"
                                                            Spacing="4"
                                                            IsVisible="{Binding IsSelected}">
                                                    <!-- Up/Down Arrows -->
                                                    <StackPanel Orientation="Vertical"
                                                                Spacing="2">
                                                        <!-- Up Arrow -->
                                                        <Button Width="24"
                                                                Height="14"
                                                                Padding="0"
                                                                Background="Transparent"
                                                                BorderThickness="0"
                                                                Command="{Binding DataContext.IncreaseCountCommand, ElementName=Root}"
                                                                CommandParameter="{Binding}">
                                                            <Path Fill="Black"
                                                                  Stretch="Uniform"
                                                                  HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center"
                                                                  Data="M 0 10 L 12 0 L 24 10 Z" />
                                                        </Button>
                                                        <!-- Down Arrow -->
                                                        <Button Width="24"
                                                                Height="14"
                                                                Padding="0"
                                                                Background="Transparent"
                                                                BorderThickness="0"
                                                                Command="{Binding DataContext.DecreaseCountCommand, ElementName=Root}"
                                                                CommandParameter="{Binding}">
                                                            <Path Fill="Black"
                                                                  Stretch="Uniform"
                                                                  HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center"
                                                                  Data="M 0 0 L 12 10 L 24 0 Z" />
                                                        </Button>
                                                    </StackPanel>
                                                    <!-- Label -->
                                                    <TextBlock Text="Amount"
                                                               VerticalAlignment="Center"
                                                               Foreground="Black"
                                                               FontSize="14"
                                                               FontWeight="Bold" />
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>
                    </StackPanel>
                </StackPanel>
                <!-- ========== MIDDLE COLUMN ========== -->
                <Border Grid.Column="1"
                        Width="60"
                        Height="60"
                        Background="Red"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Top" />
                <!-- ========== RIGHT COLUMN ========== -->
                <StackPanel Grid.Column="2"
                            Orientation="Vertical"
                            VerticalAlignment="Top"
                            HorizontalAlignment="Right"
                            Spacing="10">
                    <CheckBox Content="Hide English"
                              IsChecked="{Binding HideEnglish}" />
                    <CheckBox Content="Hide Pinyin"
                              IsChecked="{Binding HidePinyin}" />
                    <CheckBox Content="Hide POS"
                              IsChecked="{Binding HidePos}" />
                    <CheckBox Content="Allow Repeats"
                              IsChecked="{Binding WordRepeats}" />
                </StackPanel>
            </Grid>
        </Border>
        <!-- ==================== MAIN CONTENT ==================== -->
        <ScrollViewer Margin="0,20,0,0">
            <StackPanel HorizontalAlignment="Center"
                        MaxWidth="1000"
                        Spacing="20">
                <!-- ========== CARD WINDOW ========== -->
                <Border Background="#CCC1AA"
                        CornerRadius="12"
                        Padding="20"
                        HorizontalAlignment="Stretch"
                        Width="940"
                        MinHeight="440">
                    <!-- Use ItemsControl bound to CurrentWords -->
                    <ItemsControl ItemsSource="{Binding CurrentWords}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <!-- Single Card -->
                                <Border Background="#7A6945"
                                        Width="280"
                                        Height="400"
                                        Margin="10"
                                        CornerRadius="8"
                                        Padding="10"
                                        BorderBrush="#555"
                                        BorderThickness="1">
                                    <Grid RowDefinitions="*,Auto">
                                        <!-- Card Content -->
                                        <Grid>
                                            <StackPanel VerticalAlignment="Center"
                                                        HorizontalAlignment="Center"
                                                        Spacing="10">
                                                <TextBlock Text="{Binding Word.Character}"
                                                           FontSize="72"
                                                           FontWeight="Bold"
                                                           Foreground="Black"
                                                           HorizontalAlignment="Center" />
                                                <TextBlock Text="{Binding Word.Pinyin}"
                                                           FontSize="24"
                                                           Foreground="Black"
                                                           HorizontalAlignment="Center"
                                                           IsVisible="{Binding DataContext.HidePinyin, ElementName=Root, Converter={StaticResource InverseBoolConverter}}" />
                                                <TextBlock Text="{Binding Word.English}"
                                                           FontSize="18"
                                                           Foreground="Black"
                                                           HorizontalAlignment="Center"
                                                           IsVisible="{Binding DataContext.HideEnglish, ElementName=Root, Converter={StaticResource InverseBoolConverter}}" />
                                            </StackPanel>
                                        </Grid>
                                        <!-- POS text at bottom -->
                                        <TextBlock Grid.Row="1"
                                                   Text="{Binding PickedForPOS}"
                                                   FontSize="14"
                                                   FontWeight="Bold"
                                                   Foreground="Black"
                                                   HorizontalAlignment="Center"
                                                   Margin="0,10,0,0"
                                                   IsVisible="{Binding DataContext.HidePos, ElementName=Root, Converter={StaticResource InverseBoolConverter}}" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Border>
                <!-- ========== RANDOMIZE BUTTON ========== -->
                <Button Name="RandomizeButton"
                        Content="Randomize"
                        Command="{Binding RandomizeCommand}"
                        Width="180"
                        Height="44"
                        HorizontalAlignment="Center"
                        Background="#7A6945"
                        Foreground="Black"
                        FontWeight="Bold"
                        FontSize="20"
                        VerticalContentAlignment="Center"
                        HorizontalContentAlignment="Center" />
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</UserControl>